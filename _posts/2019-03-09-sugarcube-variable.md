---
layout: post
title: "SugarCube教程一：变量"
date: 2019-03-09
author: Thespit
---

# 本文使用的软件版本

我在写本文的时候使用的是v2版本，推荐同时阅读[官方文档](http://www.motoslave.net/sugarcube/2/docs/)。搭配使用的[Twine](http://twinery.org/)版本是2.21.0。

# 前言

[Twine](http://twinery.org/)是一个简单然而强力的文本游戏制作工具，代表作是移动平台上的游戏系列“生命线（lifeline）”。在[itch.io](https://itch.io/games/made-with-twine)上也有很多使用Twine制作做的文字冒险游戏。SugarCube是Twine支持的一种脚本语言，主要用来制作游戏中的各种程序逻辑判断，毕竟Twine游戏不是一个静态小说，游戏需要对玩家做出的选择产生不同的反馈。和SugarCube同类的脚本语言还有几种，功能上并没有区别只是语法不同。不过SugarCube名字好听，语法干净，所以我们就来学习SugarCube吧。

# 创建房间

首先在Twine中选择format，切换到SugarCube 2.21.0。

![1.png](https://thespit.github.io/pic/sugarcube-variable/1.png)

图1 切换脚本格式为SugarCube

然后点击“+Story”就可以创建房间，我的故事名字叫“401号房间”。

# 变量

终于说到实际的语法了。Twine游戏是一个动态的故事，所以有些事情在我们编写内容的时候是无法直接确定的，所以我们需要一个东西来记录和修改他们，这就是变量的意义了。

例子：

```
你看到墙上挂着的日历，日历上记录着今天的日子，2019年3月9日。
```

如果我们直白的编写内容，玩家每次进入房间的时候，都只会看到这句话。

双击房间，编辑内容。
![2.png](https://thespit.github.io/pic/sugarcube-variable/2.png)

图2 编辑第一个房间的内容

点击右下角的“Play”之后播放。
![3.png](https://thespit.github.io/pic/sugarcube-variable/3.png)

图3 播放游戏

就向之前说的，这是一个静态文本，我们在制作游戏的时候就固定了日期，无法直接修改内容。

如果我们把房间的内容修改为：
```
<<set $date to "2019年3月9日">>
你看到墙上挂着的日历，日历上记录着今天的日子，$date。
<<set $date to "2019年3月10日">>
这时，12声钟声响起，日历上的日期居然自动变成了$date。
```
你再运行游戏就能刚看到日期随着我们的设定进行了改变。

## 基本操作：访问和赋值

你可能已经明白了，我们使用$美元符号标记在英文单词前，表示这个单词存储了一个变量。当我们在一段话之中使用变量，实际显示的时候，Twine并不会显示变量的名字，比如date，而显示了变量所存储的值。比如2019年3月9日。

当我们需要修改变量的内容时，我们使用如下的语句形式进行赋值。
```<<set $XXXX to "XXXX">>```
其中，两个尖括号<< >>，表示这里的内容是脚本语言，Twine请不要直接显示出来。
尖括号里，用set to的语法形式将内容赋值给我们的变量。注意，文字的内容需要用英文引号" "括起来。如果是数字，我们可以省略引号。
```<<set $age to 13>>```

关于变量，就是这么简单的赋值和访问操作就足够我们做出一个有趣的故事了。但是在一些极端特殊的情况下，我们还有高级用法。

## 如果我就是想显示变量名

之前我们说了，英文前加上\$符号会告诉Twine这是一个变量，不要直接显示变量名。那如果我就是想显示\$符号怎么办呢？

我们使用三个引号"""将内容括起来，比如"""\$date"""，
```
日历上的日期是存储在"""$date"""里的，内容是$date。
```
这段话运行的结果是：
```
日历上的日期是存储在$date里的，内容是2019年3月10日。
```
除此之外我们还可以使用两个$符号，比如$$date，来做到同样的效果。

再额外的，我们还能使用```{{{ }}}```来做到类似的效果，比如```{{{ \$date }}}```。但这么做会在显示的时候，在\$date两边插入html标签中的"<code></code>"，具体的效果就是$date的字体会有些许改变。你可以自己尝试一下。

## 临时变量

在2.3.0版本中，新增了一种临时变量，这种变量以_为开头，比如_date。使用方法和之前介绍的变量一样。相对的，之前提到的以$开头的变量就被称之为故事变量。

临时变量和故事变量有什么区别呢。当我们设置一个故事变量的值时，这个变量在我们创建的故事的所有房间中都是可以访问的。比如我在“客厅”设置了今天的日期是2019年3月9日，那么当玩家进入到“阳台”时，我们使用$date一样可以获取2019年3月9日这个内容。

临时变量就正好相反了，临时变量只会在当前的房间里生效，这种变量一般用于一些临时计算。比如我想算出玩家的攻击力是多少，假设玩家的攻击力=(体重 * 0.1 + 145) / 2 + 2 * 年龄 * (体重 * 0.1 + 145) - 50，在计算的时候我们难免需要记录一些中间过程，比如我先定义a = 体重 * 0.1 + 145，a的定义只是用于方便后续的计算。计算完之后我就不需要a了，我当然不希望当我在另一个房间里计算别的值时，a因为被占用，导致我还得想另一个名字。

## 高级操作

### unset

之前我们说了赋值，所以对应的就有一个取消赋值unset。
```
unset $date
```
这个操作很容易理解，将一个变量删除，这个变量变成了未赋值的状态。

### remember

remember是一个比set更持久的记录操作。
```
remember $date to "2019年3月10日"
```
这是一个很神奇的操作，它的使用方法和set一样，与之不同的是，remember方法记录了一个变量之后，这个变量将会在你重启游戏之后仍然继续生效。
你可以试试在房间中添加如下的语句：
```
我记得上辈子的事情，我的名字叫$name。
<<remember $name to "Tom">>
```
当你第一次运行这个房间的时候，房间会显示：
我记得上辈子的事情，我的名字叫$name。
很明显，因为赋值语句在显示后面，所以没有内容。

但当你重启游戏第二次运行这个房间的时候，房间会显示：
我记得上辈子的事情，我的名字叫Tom。

也就是说上一次运行游戏时的最后一步记录住的变量$name在重启之后居然还在生效！
虽然remember命令其实没什么用吧... ...

### forget

和remeber对应的命令，使用方法和unset一样，用来清除remember定义的变量。
```
<<forget $name>>
```

## 面向对象

### 对象结构

变量可以表示一个数字，或者一段文字。除此之外，它还能有别的可能吗？答案是有。一个变量还能用来表示更加复杂的结构。
```
<<set $person to {name: "Tom", age:13}>>
```
这个语句的意思是将person变量赋值成一个JSON字符串一样的东西。如果你不知道JSON字符串是什么，自己百度一下吧，这是一种用来表示结构化信息的数据格式，本身很简单。这个字符串定义了一个结构信息，其中有一个属性叫做name，值为Tom，一个属性叫做age，值为13。
```
你看到一个人出现了，他胸口绣着一个名字$person.name，后面跟着一个数字$person.age。
```
我们可以通过上述的方式访问到person变量里面的name属性和age属性。
其实我们大可以直接定义两个变量\$name和​$age用来表示这个人的名字和年龄。不过如果游戏中我们都这样分散着定义变量，那最后想要管理起来可不容易。游戏中会有很多人出现，我可不想在一堆name中找我需要那一个。然而如果我们用结构化的方式定义一个整体，并将相关的属性放在一个JSON结构里，管理起来可就方便多了。

```
<<set $tom to {name:"Tom", age:13, atk:10, hp:50, def:20}>>
<<set $jack to {name:"Jack", age:20, atk:5, hp:45, def:30}>>
```

### 数组结构

如果你知道JSON的话，你肯定就知道当我们能够定义结构数据之后，我们一定还可以定义数组。
```
<<set $arr to [1,3,5,6,7,13,20]>>
你脑中出现了一个数列，这个数列的第一个是$arr[0]，最后一个是$arr[6]。
```
和{}结构不一样，数组用中括号[]括起来。和大部分编程语言一样的是，数组的下标是从0开始的。所以上面的例子中第一个元素是\$arr[0]。还有一点，我们可以在一个数组中定义不同类型的元素。
```<<set ​$arr to [1,2,3,4,"你好",5,6]>>```

### 补充

其他的一些奇技淫巧包括，使用中括号访问一个结构的内部属性。比如，\$tom["name"]或者​$tom['name']。其效果和\$tom.name是一样的。当我们需要方位的内部属性名本身就是一个变量时，我们会用到这种方式。
比如

```
<<set $property to "name">>
我的属性$property是$tom[$property]。
```
比较绕，自己慢慢理解。
